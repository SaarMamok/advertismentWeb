<!DOCTYPE html>
<script type="text/javascript" src="https://code.jquery.com/jquery-1.7.1.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href="/public/assets/management.css" rel="stylesheet"   type="text/css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
   
</head>
<body id="mainbody">
    <h1>Advertisments Settings </h1>
    <p id='showData' style="align-items: center;"></p>
    
    <br>
    <button class="open-button" onclick="addopenForm();">Add Advertisment</button>

    <div class="form-popup" id="AddForm">
      <form class="form-container">
        <h2>New Advertisment</h2>
    
        <label for="title"><b>Title</b></label>
        <input type="text"  placeholder="Enter Title" id="title_add" required>
    
        <label for="content"><b>Content</b></label>
        <input type="text" placeholder="Enter content" id="content_add" required>
    
        <label for="style"><b>Image</b></label>
        <input type="text" placeholder="Enter Image Url" id="style_add" required>
    
        <label for="time"><b>Time</b></label>
        <input type="number" placeholder="Enter time in sec" id="time_add" required>

        <label for="Screen-number"><b>Screem Number</b></label>
        <input type="number" placeholder="Enter Screen-number (1, 2, 3)" id="screen_number_add" required>
    
        <button type="submit" class="submit_btn" onclick="add_params();">Submit</button>
        <button type="button" class="btn cancel" onclick="closeForm();">Close</button>
      </form>
    </div>

    <div class="form-popup" id="EditForm">
        <form class="form-container">
          <h2>Edit Advertisment</h2>
      
          <label for="title"><b>Title</b></label>
          <input type="text"  placeholder="Enter Title" id="title_edit" required>
      
          <label for="content"><b>Content</b></label>
          <input type="text" placeholder="Enter content" id="content_edit" required>
      
          <label for="style"><b>Image</b></label>
          <input type="text" placeholder="Enter Image Url" id="style_edit" required>
      
          <label for="time"><b>Time</b></label>
          <input type="number" placeholder="Enter time in sec" id="time_edit" required>
  
          <label for="Screen-number"><b>Screem Number</b></label>
          <input type="number" placeholder="Enter Screen-number (1, 2, 3)" id="screen_number_edit" required>
      
          <button type="submit" class="submit_btn" onclick="edit_params();">Submit</button>
          <button type="button" class="btn cancel" onclick="closeForm();">Close</button>
        </form>
      </div>
  

</body>
</html>

<script type="text/javascript">
   
    function add_params() {
        add_to_db()
    }
    async function add_to_db() 
        {
            console.log("inside added to db");
            const title = document.getElementById("title_add").value;
            const content = document.getElementById("content_add").value
            const style = document.getElementById("style_add").value
            const time = document.getElementById("time_add").value
            const screen_number = document.getElementById("screen_number_add").value
            console.log(title)
            const result = await fetch('/api/add_adv', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    title,
                    content,
                    style,
                    time,
                    screen_number
                })
            }).then((res) => res.json())
               
            if(result.status == 'error'){
                
                alert(result.error)
                stat = false;
            }
            else{
                stat=true;
                alert(result.status)
            }
        }
  
     function addopenForm() {
      document.getElementById("AddForm").style.display = "block";
    }
    function editopenForm2() {
      document.getElementById("EditForm").style.display = "block";
    }
    function closeForm() {
      document.getElementById("AddForm").style.display = "none";
      document.getElementById("EditForm").style.display = "none";
    }
    var _row = null;
    async function delete_from_db(btn_id) 
        {
            console.log("inside delete from db");
            const title = btn_id
            const result = await fetch('/api/delete_adv', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    title
                })
            }).then((res) => res.json())
               
            if(result.status == 'error'){
                
                alert(result.error)
                stat = false;
            }
            else{
                stat=true;
                alert(result.status)
            }
        }
    function deleteadv(ctl){
        $(ctl).parents("tr").remove();
        delete_from_db(ctl.id);
    }

    async function edit_from_db(col_list) 
        {
            console.log("inside changed from db");
            const title = document.getElementById("title_edit").value;
            const content = document.getElementById("content_edit").value
            const style = document.getElementById("style_edit").value
            const time = document.getElementById("time_edit").value
            const screen_number = document.getElementById("screen_number_edit").value
            console.log(title)
            const result = await fetch('/api/edit_adv', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    title,
                    content,
                    style,
                    time,
                    screen_number
                })
            }).then((res) => res.json())
               
            if(result.status == 'error'){
                
                alert(result.error)
                stat = false;
            }
            else{
                stat=true;
                alert(result.status)
            }
        }

    list_type = []
    function editadv(ctl){
        console.log(ctl.t)
        editopenForm2();
        _row = $(ctl).parents("tr");
        var cols = _row.children("td");
        $("#title_edit").val($(cols[1]).text());
        $("#content_edit").val($(cols[2]).text());
        $("#style_edit").val($(cols[3]).text());
        $("#time_edit").val($(cols[4]).text());
        $("#screen_number_edit").val($(cols[5]).text());
    }

    function edit_params(){
        edit_from_db(list_type);
    }
    
    var data_list = '<%- (data) %>';

    const data_obj = JSON.parse (data_list)         

     $(document).ready(function()
        {
            // $('#advertisment_title').text(data_obj[i].title);
            // $('#image_advrtisment').attr('src', data_obj[i].style);
            // $('#mainbody').append(data_obj);
            // for(i=0;i<data_obj.length;i++){
                
            // }
            // console.log(Object.keys(data_obj[0]));
            var col = [];
            for (var i = 0; i < data_obj.length; i++) {
                for (var key in data_obj[i]) {
                    if (col.indexOf(key) === -1) {
                        col.push(key);
                    }
                }

            }
            var table = document.createElement("table");
            // col.push("Action");
            var tr = table.insertRow(-1); 

            // titles
            for(var i = 0; i< Object.keys(data_obj[0]).length; i++){
                var th = document.createElement("th");     
                th.innerHTML = col[i];
                tr.appendChild(th);
            }
            var th = document.createElement("th");     
                th.innerHTML = "Action";
                tr.appendChild(th);
            // data
            for(var i=0;i<data_obj.length;i++){
                tr = table.insertRow(-1);

                for (var j = 0; j < col.length; j++) {
                    var tabCell = tr.insertCell(-1);
                    tabCell.innerHTML = data_obj[i][col[j]];    
                }
                var advertise_id = data_obj[i].title;
                var tabCell = tr.insertCell(-1);
                tabCell.innerHTML = "<input id='edit_btn' type='button' onclick='editadv(this);' value='Edit'/>" + "<input id='"+advertise_id+"'   type='button' onclick='deleteadv(this);' value='Delete'/>";
            }
            var divShowData = document.getElementById('showData');
            divShowData.innerHTML = "";
            divShowData.appendChild(table);
            
        }
   
    
     ); 
   
</script>